<div class="card">
    <div class="card-body">
      <form th:action="@{/opportunites/ajouter}" th:object="${opportunite}" method="post">
        
        <!-- CONTEXTE CLAIR -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h4 class="text-primary mb-1">
              <i class="ti ti-bullseye me-2"></i>Nouvelle Opportunité
            </h4>
            <div class="d-flex align-items-center text-muted">
              <i class="ti ti-user me-2"></i>
              <span th:text="${client.prenom + ' ' + client.nom}"></span>
              <span th:if="${client.entreprise}" th:text="' - ' + ${client.entreprise}"></span>
              <span class="badge bg-light text-dark ms-2" th:text="'Score: ' + ${client.scoreProspect} + '/10'"></span>
            </div>
          </div>
        </div>

        <!-- INFORMATIONS CLIENT RAPIDES (Lecture seule) -->
        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <label class="form-label fw-semibold">Client</label>
            <div class="form-control bg-light">
              <strong th:text="${client.prenom + ' ' + client.nom}"></strong>
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-semibold">Entreprise</label>
            <div class="form-control bg-light" th:text="${client.entreprise} ?: 'Non renseigné'"></div>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-semibold">Score prospect</label>
            <div class="form-control bg-light" th:text="${client.scoreProspect} + '/10'"></div>
          </div>
        </div>

        <!-- FORMULAIRE OPPORTUNITÉ -->
        <div class="row g-3">
          <div class="col-12">
            <label class="form-label fw-semibold">Nom de l'opportunité *</label>
            <input type="text" th:field="*{nomOpportunite}" class="form-control" 
                   th:attr="placeholder='Ex: ' + (${client.entreprise} ?: ${client.prenom}) + ' - Projet 2024'" required>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Montant estimé (€)</label>
            <input type="number" th:field="*{montantEstime}" class="form-control" 
                   placeholder="Basé sur le score: [[${client.scoreProspect * 1000}]]">
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Probabilité</label>
            <select th:field="*{probabilite}" class="form-select">
              <option th:each="i : ${#numbers.sequence(10, 90, 10)}" 
                      th:value="${i}"
                      th:selected="${i == client.scoreProspect * 10}"
                      th:text="${i + '%'}">
              </option>
            </select>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Date de clôture</label>
            <input type="date" th:field="*{dateCloturePrevue}" class="form-control"
                   th:value="${#temporals.format(#temporals.createNow().plusDays(30), 'yyyy-MM-dd')}">
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Étape</label>
            <select th:field="*{etapeVente}" class="form-select">
              <option value="PROSPECTION">Prospection</option>
              <option value="QUALIFICATION" selected>Qualification</option>
              <option value="PROPOSITION">Proposition</option>
              <option value="NEGOCIATION">Négociation</option>
            </select>
          </div>

          <div class="col-12">
            <label class="form-label fw-semibold">Description</label>
            <textarea th:field="*{description}" class="form-control" rows="3"
                      th:attr="placeholder='Opportunité avec ' + ${client.prenom} + ' ' + ${client.nom} + '...'"></textarea>
          </div>
        </div>

        <!-- CHAMP HIDDEN POUR LE CLIENT -->
        <input type="hidden" th:field="*{client.id}">

        <!-- ACTIONS -->
        <div class="mt-4 pt-3 border-top d-flex gap-2 justify-content-between">
          <a th:href="@{/clients/{id}(id=${client.id})}" class="btn btn-outline-secondary">
            <i class="ti ti-arrow-left me-2"></i>Retour au client
          </a>
          <div>
            <button type="submit" class="btn btn-primary">
              <i class="ti ti-bullseye me-2"></i>Créer l'opportunité
            </button>
          </div>
        </div>

      </form>
    </div>
  </div>
</div>